From 759e70d4743828cb902f093a3cee8a7af76f2440 Mon Sep 17 00:00:00 2001
From: "Zhang,Vivian" <vivian.zhang@intel.com>
Date: Wed, 28 Nov 2012 21:55:54 +0800
Subject: [PATCH 18/23] Configure modem I2s1 to 8khz,mono if routing to
 bluetooth, fixed TZSP-3943: modem configuration to
 support HFP
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: 8bit

---
 src/s_call.c |   18 ++++++++++++------
 1 file changed, 12 insertions(+), 6 deletions(-)

diff --git a/src/s_call.c b/src/s_call.c
index 2d2b711..762fb24 100644
--- a/src/s_call.c
+++ b/src/s_call.c
@@ -2880,11 +2880,17 @@ static TReturn s_call_set_sound_path(CoreObject *o, UserRequest *ur)
 
 	plugin = tcore_object_ref_plugin(o);
 
-    // Configure modem I2S1
-    prepare_and_send_pending_request(plugin, "call", "AT+XDRV=40,4,3,0,1,0,8,0,1,0,2,0,21", NULL, TCORE_AT_NO_RESULT, NULL);
-    prepare_and_send_pending_request(plugin, "call", "AT+XDRV=40,5,2,0,1,0,8,0,1,0,2,0,22", NULL, TCORE_AT_NO_RESULT, NULL);
+	/* Configure modem I2S1 to 8khz, mono, PCM if routing to bluetooth */
+	if (SoundPathP->path == CALL_SOUND_PATH_BLUETOOTH) {
+			prepare_and_send_pending_request(plugin, "call", "AT+XDRV=40,4,3,0,1,0,0,0,0,0,0,0,21", NULL, TCORE_AT_NO_RESULT, NULL);
+			prepare_and_send_pending_request(plugin, "call", "AT+XDRV=40,5,2,0,1,0,0,0,0,0,0,0,22", NULL, TCORE_AT_NO_RESULT, NULL);
+	}
+	else {
+			prepare_and_send_pending_request(plugin, "call", "AT+XDRV=40,4,3,0,1,0,8,0,1,0,2,0,21", NULL, TCORE_AT_NO_RESULT, NULL);
+			prepare_and_send_pending_request(plugin, "call", "AT+XDRV=40,5,2,0,1,0,8,0,1,0,2,0,22", NULL, TCORE_AT_NO_RESULT, NULL);
+	}
 
-	// Configure modem I2S2 and do the modem routing
+	/* Configure modem I2S2 and do the modem routing */
     prepare_and_send_pending_request(plugin, "call", "AT+XDRV=40,4,4,0,0,0,8,0,1,0,2,0,21", NULL, TCORE_AT_NO_RESULT, NULL);
     prepare_and_send_pending_request(plugin, "call", "AT+XDRV=40,5,3,0,0,0,8,0,1,0,2,0,22", NULL, TCORE_AT_NO_RESULT, NULL);
     prepare_and_send_pending_request(plugin, "call", "AT+XDRV=40,6,0,4", NULL, TCORE_AT_NO_RESULT, NULL);
@@ -2892,10 +2898,10 @@ static TReturn s_call_set_sound_path(CoreObject *o, UserRequest *ur)
     prepare_and_send_pending_request(plugin, "call", "AT+XDRV=40,6,4,2", NULL, TCORE_AT_NO_RESULT, NULL);
     prepare_and_send_pending_request(plugin, "call", "AT+XDRV=40,6,5,2", NULL, TCORE_AT_NO_RESULT, NULL);
 
-    // amc enable
+    /* amc enable */
 	prepare_and_send_pending_request(plugin, "call", "AT+XDRV=40,2,4", NULL, TCORE_AT_NO_RESULT, NULL); //AMC_I2S2_RX
 	prepare_and_send_pending_request(plugin, "call", "AT+XDRV=40,2,3", NULL, TCORE_AT_NO_RESULT, NULL); //AMC_I2S1_RX
-    // amc route: AMC_RADIO_RX => AMC_I2S1_TX
+    /* amc route: AMC_RADIO_RX => AMC_I2S1_TX */
 	prepare_and_send_pending_request(plugin, "call", "AT+XDRV=40,6,0,2", NULL, TCORE_AT_NO_RESULT, NULL);
 
 	usleep(40000); // Time to Enable modem I2S...
-- 
1.7.10.4

